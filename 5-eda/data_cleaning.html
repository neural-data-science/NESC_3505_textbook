

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Data Cleaning - Dealing with Outliers &#8212; Neural Data Science in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1SNTM6T50K"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-1SNTM6T50K');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '5-eda/data_cleaning';</script>
    <link rel="canonical" href="http://neuraldatascience.io/5-eda/data_cleaning.html" />
    <link rel="shortcut icon" href="../_static/NESC3505_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basic Statistics in Python: t tests with SciPy" href="ttests.html" />
    <link rel="prev" title="Working with Repeated Measures Data" href="repeated_measures.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/NESC3505_icon.png" class="logo__image only-light" alt="Neural Data Science in Python - Home"/>
    <script>document.write(`<img src="../_static/NESC3505_icon.png" class="logo__image only-dark" alt="Neural Data Science in Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Neural Data Science in Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Course</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1-intro/why.html">Start with why</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-intro/learning_objectives.html">Learning Objectives for this Course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../1-intro/learning_approach.html">How to Approach this Course</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/actually_write_code.html">Actually Write Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/mindset.html">Mindset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/flipped_classroom.html">Flipped Classroom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/errors_debugging.html">Errors and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/ai.html">Artificial Intelligence-Assisted Coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/teamwork.html">Collaboration and Teamwork</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../1-intro/pedagogy.html">Pedagogy</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/teaching_approach.html">Teaching Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/authenticity.html">Authenticity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/21st_cen_skills.html">21st Century Skills</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/constructivism.html">Constructivism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/connectivism.html">Connectivism</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../1-intro/open.html">Open Resources</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/software.html">Free Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/free_licenses.html">Free and Open-Source Software Licenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/open_science.html">Open Science</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/peer_review.html">Peer Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/for_profit.html">For-Profit Publishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/impact_factors.html">Impact Factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/novelty.html">Novelty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/open_publishing.html">Open Publishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/preregistration.html">Preregistration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/open_methods.html">Open Methods and Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/oer.html">Open Educational Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/oer_this_course.html">OERs in the Context of this Course</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-intro/licenses.html">Licenses</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to Data Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../2-nds/introduction.html">Getting Started with the Course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-nds/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2-nds/what_is_nds.html">What is Data Science?</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/data.html">What is Data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/where.html">Where Does Neural Data Come From?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/data_science.html">Data Science</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/data_cleaning.html">Data Cleaning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2-nds/tools_for_nds.html">Tools for Neural Data Science</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/spreadsheets.html">Spreadsheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/spreadsheets_limits.html">Limitations of Spreadsheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/reproducibility.html">Reproducibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/sci_prog_lang.html">Scientific Programming Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/which_lang.html">Which language to use?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/libs.html">Libraries and packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/why_python.html">Why Python for this Course?</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2-nds/coding.html">Coding Tools</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/terminal.html">The Terminal and Command Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/jupyter.html">Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/markdown.html">Markdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/vscode.html">Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-nds/github.html">GitHub</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Set Up Your Computer for Data Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../2b-setup/introduction.html">Some Assembly Required</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2b-setup/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2b-setup/install_tools.html">Install Tools for Data Science</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/github.html">Get on GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/anaconda.html">Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/vscode.html">VS Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/github_classroom.html">GitHub Classroom</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2b-setup/first_repo.html">Your First GitHub Repository</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/github_repo.html">Exploring the GitHub Repository view</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/repo_in_vscode.html">Open the Repository in VS Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/edit_commit_push.html">Editing, Pushing, and Committing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/edit_readme.html">Edit the README File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b-setup/new_markdown_file.html">Create a New Markdown File</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2b-setup/getting_help.html">Getting Help on an Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2b-setup/submitting_assignments.html">Submitting Assignments</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introducing Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3-python/introduction.html">Introducing Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-python/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3-python/preliminaries.html">Preliminaries</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../3-python/jupyter_vscode.html">Introduction to Jupyter Notebooks in VS Code</a></li>

<li class="toctree-l2"><a class="reference internal" href="../3-python/getting_help.html">Getting Help with Python</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3-python/data_types.html">Data types</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../3-python/variables_assignment.html">Variables and Assignment</a></li>

<li class="toctree-l2"><a class="reference internal" href="../3-python/types_conversion.html">Data Types and Conversion</a></li>

<li class="toctree-l2"><a class="reference internal" href="../3-python/builtin.html">Python Built-Ins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3-python/lists.html">Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3-python/dictionaries.html">Dictionaries</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3-python/flow_control.html">Flow Control</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../3-python/for_loops.html"><code class="docutils literal notranslate"><span class="pre">for</span></code> Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3-python/conditionals.html">Conditionals</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3-python/working_w_data.html">Working with Data</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../3-python/pandas_dataframes.html">pandas DataFrames</a></li>


<li class="toctree-l2"><a class="reference internal" href="../3-python/looping_data_files.html">Looping Over Data Files</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">AI-Assisted Coding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3b-ai_assisted/introduction.html">Introducing GitHub Copilot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3b-ai_assisted/ai_assisted.html">Introduction to GitHub Copilot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3b-ai_assisted/rt_data.html">Exercises – Reaction Time Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3b-ai_assisted/pandas_copilot.html">Data Files and pandas DataFrames</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3b-ai_assisted/multi_data_files.html">Working With Multiple Data Files Using Copilot</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../3b-ai_assisted/multi_data_files_1.html">Reading Data Files with pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3b-ai_assisted/multi_data_files_2.html">Computing Mean Reaction Times and Confidence Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3b-ai_assisted/multi_data_files_3.html">Formatting the Output in a Table</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualizing Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../4-viz/introduction.html">Introduction to Data Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/plotting.html">Introduction to Plotting with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/proc_vs_oo.html">Procedural versus Object-Oriented Plotting in Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/subplots.html">Subplots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/plotting_types.html">Thinking About Data for Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/seaborn.html">Data Science Plots with Seaborn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-viz/human_factors.html">Accessibility and Human Factors in Plotting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploratory Data Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to EDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeated_measures.html">Working with Repeated Measures Data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Data Cleaning - Dealing with Outliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ttests.html">Basic Statistics in Python: <em>t</em> tests with SciPy</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Single Unit Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../6-single_unit/introduction.html">Introduction to Single Unit Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-single_unit/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../6-single_unit/single_unit_intro.html">Single Unit Data and Spike Trains</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../6-single_unit/intro_spike_trains.html">Introduction to Spike Train Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6-single_unit/ten_intensities.html">Effects of Light Intensity on Spike Rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6-single_unit/heat_maps.html">Heat Maps</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../6-single_unit/intro_multielec_data.html">Introducing Multielectrode Data</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../6-single_unit/pandas_multielec.html">Working with Multielectrode Data in pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6-single_unit/corr_spike_trains.html">Correlating spike trains</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">EEG Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../7-eeg/introduction.html">Introduction to EEG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7-eeg/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7-eeg/about_eeg.html">What is EEG?</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../7-eeg/approaches.html">EEG in the Time and Frequency Domains</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/time_freq.html">Time and Frequency Domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/erps.html">Event-Related Potentials (ERPs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/components.html">ERP Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7-eeg/mne_python.html">MNE-Python</a></li>


<li class="toctree-l1 has-children"><a class="reference internal" href="../7-eeg/erp_preprocessing.html">EEG-ERP Preprocessing</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/erp_filtering.html">Filtering EEG Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/erp_artifacts.html">Artifacts in EEG Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/erp_segmentation.html">Segmentation into ERP epochs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7-eeg/erp_avg_reref.html">Averaging and Re-Referencing ERPs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7-eeg/erp_group.html">Group Analysis of ERP Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MRI Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../8-mri/introduction.html">Introduction to MRI Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8-mri/learning_objectives.html">Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8-mri/read_viz.html">Reading and Visualizing Structural MRI Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8-mri/nifti.html">Working with NIfTI images</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../9-machine_learning/introduction.html">Introduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../zrefs.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/neural-data-science/NESC_3505_textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/neural-data-science/NESC_3505_textbook/issues/new?title=Issue%20on%20page%20%2F5-eda/data_cleaning.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/5-eda/data_cleaning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Cleaning - Dealing with Outliers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outlier-identification-and-removal">Outlier Identification and Removal</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-s-method">Tukey’s method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-scores">Standard scores</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identifying-outliers">Identifying outliers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-distribution">Visualizing the distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#idenfity-outliers-in-a-dataframe">Idenfity outliers in a DataFrame</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#marking-data-points-as-outliers">Marking data points as outliers</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-scores-z-transform">Standard scores (<em>z</em> transform)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#write-column-of-standard-score-outliers">Write column of standard score outliers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-outliers-a-problem">Why are outliers a problem?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#which-method-to-use">Which method to use?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-empirical-study-addressing-outlier-removal-with-rt-data">An empirical study addressing outlier removal with RT data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-to-do-with-outliers">What to do with outliers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ignore-them">1. Ignore them</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-them-from-the-data-set">2. Remove them from the data set</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replace-them-with-non-outlier-values">3. Replace them with non-outlier values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replacing-outliers-with-mean-values">Replacing outliers with mean values</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reporting-outlier-rejections">Reporting outlier rejections</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-nested-data">Working with nested data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-z-scores-by-participant">Compute <em>z</em> scores by participant</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-mean-rt-from-valid-trials-for-each-participant">Compute mean RT from valid trials for each participant</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fill-in-mean-values-for-outlier-rows">Fill in mean values for outlier rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-final-output-column">Create final output column</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-cleaned-data">Visualizing the cleaned data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#box-plots">Box plots</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#before-outlier-correction">Before outlier correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#after-outlier-correction">After outlier correction</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-density-estimates">Kernel density estimates</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Before outlier correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">After outlier correction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-cleaning-dealing-with-outliers">
<h1>Data Cleaning - Dealing with Outliers<a class="headerlink" href="#data-cleaning-dealing-with-outliers" title="Permalink to this heading">#</a></h1>
<p>An important first step in data science is cleaning up your data. This includes identifying and removing data points that may be due to errors in data collection, or other factors that could lead us to make erroneous conclusions about the data. This is <em>not</em> the same as “cooking” your data — modifying it specifically to get the results you want. Data cleaning involves a set of methods that are specifically designed to identify and remove data points that are objectively anomalous — that is, you have objective reasons for removing them. Data cleaning steps should always be documented when you write up a study, and should be included in the code you share for analyses so that your procedures are transparent and reproducible.</p>
<section id="outlier-identification-and-removal">
<h2>Outlier Identification and Removal<a class="headerlink" href="#outlier-identification-and-removal" title="Permalink to this heading">#</a></h2>
<p><strong>Outliers</strong> are data points that are “significantly different” from the majority of data points in a data set. “Significantly different” is in quotes here, because this doesn’t not necessarily mean we use statistical testing to define outliers, and also that there several different definitions of “significant” that ca be used to identify outliers.</p>
<section id="tukey-s-method">
<h3>Tukey’s method<a class="headerlink" href="#tukey-s-method" title="Permalink to this heading">#</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/John_Tukey">John Tukey</a>, <a class="reference external" href="https://scholar.google.com/scholar_lookup?&amp;journal=Exploratory+Data+Analysis&amp;author=Tukey+J.+W.&amp;publication_year=1977&amp;volume=Vol.%202">who was a driving force in the development of exploratory data analysis</a>, defined outliers as points more than <span class="math notranslate nohighlight">\(1.5 x IQR\)</span>. Recall that IQR is the <em>inter-quartile range</em>, which captures 50% of the data points in a data set. In a box plot (which Tukey invented), the IQR is the “box”, and 1.5 IQR are the extent of the “whiskers” in each direction from the median. We noted earlier that in box plots, outliers are represented as individual points in the plot, beyond the whiskers. Since Tukey invented box plots and this definition of outliers, it’s not surprising that they are identical. In general, outliers defined in this way will comprise approximately 1% of the data, if the data are approximately normally distributed.</p>
<p><img alt="" src="../_images/boxplot_vs_pdf.png" /></p>
<p><em>Image from <a class="reference external" href="https://en.wikipedia.org/wiki/User:Jhguch">Jhguch</a> and shared under the  <a class="reference external" href="https://creativecommons.org/licenses/by-sa/2.5/deed.en">Creative Commons Attribution-Share Alike 2.5 Generic</a> license, via Wikimedia Commons</em></p>
</section>
<section id="standard-scores">
<h3>Standard scores<a class="headerlink" href="#standard-scores" title="Permalink to this heading">#</a></h3>
<p>An alternative method is to use standard scores. This is done by applying the <strong><em>z</em> transform</strong> to the data. This transform’s formula is:</p>
<p>$z = \frac{x - \mu}{\sigma}$</p>
<p>Where <span class="math notranslate nohighlight">\(x\)</span> is an individual data point, <span class="math notranslate nohighlight">\(\mu\)</span> is the mean of the data set, and <span class="math notranslate nohighlight">\(\sigma\)</span> is the standard deviation. In other words, the <em>z</em> transform takes a data set and transforms it so that its mean is zero (by subtracting the mean from every value), and its standard deviation as 1.</p>
<p>Put another way, after we apply a <em>z</em> transform to a data set, the numerical values in the data set are not in their original units (be that milliseconds, or dollars, or whatever) but in units of standard deviations. So in a <em>z</em> transformed data set, a data point with a value of 1 would have had an original value that was 1 standard deviation from the mean. This is where the “standard” in “standard scores” comes from.</p>
<p>Applying a <em>z</em> transform is also called <em>normalizing</em> the data set, because the <em>z</em> transform assumes that the data come from a normal distribution (also known as a Gaussian distribution, or the <em>bell curve</em>). The nice thing about standardizing a data set is that the values have fairly straightforward interpretations. In a normal distribution:</p>
<ul class="simple">
<li><p>68.27% of all values fall within ±1 standard deviation of the mean (<span class="math notranslate nohighlight">\(1 \sigma\)</span>),</p></li>
<li><p>95.45% of all values fall within ±2 standard deviations of the mean (<span class="math notranslate nohighlight">\(2 \sigma\)</span>), and</p></li>
<li><p>99.73% of all values fall within ±3 standard deviations of the mean (<span class="math notranslate nohighlight">\(3 \sigma\)</span>)</p></li>
</ul>
<img alt="M. W. Toews, CC BY 2.5 &lt;https://creativecommons.org/licenses/by/2.5&gt;, via Wikimedia Commons" src="images/standard_deviation_diagram.svg" width=500>
<p><em>Image from M. W. Toews, and shared under the  <a class="reference external" href="https://creativecommons.org/licenses/by-sa/2.5/deed.en">Creative Commons Attribution-Share Alike 2.5 Generic</a> license, via <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Standard_deviation_diagram_micro.svg">Wikimedia Commons</a></em></p>
<p>This means that if we define outliers as those values <em>z</em> &gt; 3 or <em>z</em> &lt; -3, then we will tend to reject about 0.25% of a data set. Sometimes, <em>z</em> ±2.5 <span class="math notranslate nohighlight">\(\sigma\)</span> is used instead. This will tend to reject more data points (typically around 2%).</p>
</section>
</section>
<section id="identifying-outliers">
<h2>Identifying outliers<a class="headerlink" href="#identifying-outliers" title="Permalink to this heading">#</a></h2>
<p>First, we’ll load in the same Flanker data set we used in the <a class="reference internal" href="repeated_measures.html"><span class="doc std std-doc"><em>Repeated Measures</em></span></a> lesson:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/flanker_rt_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="visualizing-the-distribution">
<h3>Visualizing the distribution<a class="headerlink" href="#visualizing-the-distribution" title="Permalink to this heading">#</a></h3>
<p>Let’s generate a box plot of the entire data set, organized by condition. This is the same as the first box plot in the <em>Repeated Measures</em> lesson.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">x</span><span class="o">=</span><span class="s1">&#39;flankers&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6438e772fb60ba8e9830fe9270ca9338d9ebf38244f2338b78d91bd99de6e76c.png" src="../_images/6438e772fb60ba8e9830fe9270ca9338d9ebf38244f2338b78d91bd99de6e76c.png" />
</div>
</div>
<p>Let’s also look at the distribution of values with a kernel density estimate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;flankers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2f5976a242a3e19132649913beff3c368802952c0e5d3fabf084449659268e82.png" src="../_images/2f5976a242a3e19132649913beff3c368802952c0e5d3fabf084449659268e82.png" />
</div>
</div>
</section>
<section id="idenfity-outliers-in-a-dataframe">
<h3>Idenfity outliers in a DataFrame<a class="headerlink" href="#idenfity-outliers-in-a-dataframe" title="Permalink to this heading">#</a></h3>
<p>To define values based on the IQR, we first need to calculate the IQR. pandas doesn’t have a method for this specifically, but we can use the pandas <code class="docutils literal notranslate"><span class="pre">.quantile()</span></code> method with the argument 0.25 to reference the lower end of the IQR (the 0.25 quantile means the point below which 25% of data values lie), and 0.75 for the upper end of the IQR. Since IQR is defined as the range between the 25th and 75th quantiles, we can compute it be subtracting the difference between the two:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
</pre></div>
</div>
</div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">iqr</span></code> represents the size of the box in the box plot of the data. Recall that our definition of outliers is 1.5 x IQR — the length of the whiskers in the box plot.</p>
<p>We can now define the threshold for values we well call “outliers” (i.e., the length of the whiskers) based on <code class="docutils literal notranslate"><span class="pre">iqr</span></code>:””</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out_low</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
<span class="n">out_high</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
</pre></div>
</div>
</div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">out_low</span></code> (the end of the bottom whisker) is 1.5 x IQR below q1 (the lower end of the box), and likewise for <code class="docutils literal notranslate"><span class="pre">out_high</span></code>.</p>
<p>Recall from the <span class="xref myst">pandas</span> lesson that we can select values in a DataFrame using a Boolean mask. We can do that here to identify the rows of the DataFrame where the RT values are lower than 1.5 x IQR:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">out_low</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       False
1       False
2       False
3       False
4       False
        ...  
4284    False
4285    False
4286    False
4287    False
4288    False
Name: rt, Length: 4289, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>The result will have values of <code class="docutils literal notranslate"><span class="pre">True</span></code> for those data points that are “low” outliers, and <code class="docutils literal notranslate"><span class="pre">False</span></code> for all other data points. We can count the number of these by passing the mask to <code class="docutils literal notranslate"><span class="pre">np.sum()</span></code> (since <code class="docutils literal notranslate"><span class="pre">True</span></code> = <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> = <code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">out_low</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p>We can do the same to identify outliers at the high end of the range of values, using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operator this time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>110
</pre></div>
</div>
</div>
</div>
<p>Consistent with what we saw in the box plot, there are more outliers at the high (slow RT) end of the distribution than at the low (fast RT) end.</p>
<section id="marking-data-points-as-outliers">
<h4>Marking data points as outliers<a class="headerlink" href="#marking-data-points-as-outliers" title="Permalink to this heading">#</a></h4>
<p>We’ll worry about what to do with outliers later — after we’ve described standard scores. For now, let’s make a column in <code class="docutils literal notranslate"><span class="pre">df</span></code> called <code class="docutils literal notranslate"><span class="pre">outliers_tukey</span></code> that is a Boolean mask: values of <code class="docutils literal notranslate"><span class="pre">True</span></code> in rows with outlier RT values, and <code class="docutils literal notranslate"><span class="pre">False</span></code> for all other rows.</p>
<p>To do this, we want to combine the two masking operations above <code class="docutils literal notranslate"><span class="pre">&lt;</span> <span class="pre">out_low</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">out_high</span></code>. We can do that using the OR <code class="docutils literal notranslate"><span class="pre">|</span></code> operator, as long as we include each of our masking operations in parentheses (this last bit is important, but easy to forget!):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">out_low</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       False
1       False
2       False
3       False
4       False
        ...  
4284    False
4285    False
4286    False
4287    False
4288     True
Name: rt, Length: 4289, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>It’s a bit hard to confirm that this works from the output above, but if we pass that whole expression to <code class="docutils literal notranslate"><span class="pre">np.sum()</span></code> we can see that the number of all <code class="docutils literal notranslate"><span class="pre">True</span></code> values is the same as the total of the <code class="docutils literal notranslate"><span class="pre">out_low</span></code> and <code class="docutils literal notranslate"><span class="pre">out_high</span></code> values reported above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">out_low</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_high</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>120
</pre></div>
</div>
</div>
</div>
<p>To actually use this expression to create a new column, we just have to assign the result to a new column name in <code class="docutils literal notranslate"><span class="pre">df</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_tukey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">out_low</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;rt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">out_high</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s25</td>
      <td>1</td>
      <td>1</td>
      <td>congruent</td>
      <td>0.652072</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s25</td>
      <td>1</td>
      <td>2</td>
      <td>neutral</td>
      <td>0.644872</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s25</td>
      <td>1</td>
      <td>3</td>
      <td>congruent</td>
      <td>0.445182</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s25</td>
      <td>1</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.525200</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s25</td>
      <td>1</td>
      <td>5</td>
      <td>congruent</td>
      <td>0.533328</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And double-check the number, using the pandas <code class="docutils literal notranslate"><span class="pre">.sum()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_tukey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>120
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="standard-scores-z-transform">
<h3>Standard scores (<em>z</em> transform)<a class="headerlink" href="#standard-scores-z-transform" title="Permalink to this heading">#</a></h3>
<p>We can convert scores to standard scores very easily, using the <code class="docutils literal notranslate"><span class="pre">zscore()</span></code> function in <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
      <th>rt_z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s25</td>
      <td>1</td>
      <td>1</td>
      <td>congruent</td>
      <td>0.652072</td>
      <td>False</td>
      <td>1.526800</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s25</td>
      <td>1</td>
      <td>2</td>
      <td>neutral</td>
      <td>0.644872</td>
      <td>False</td>
      <td>1.456483</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s25</td>
      <td>1</td>
      <td>3</td>
      <td>congruent</td>
      <td>0.445182</td>
      <td>False</td>
      <td>-0.493736</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s25</td>
      <td>1</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.525200</td>
      <td>False</td>
      <td>0.287737</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s25</td>
      <td>1</td>
      <td>5</td>
      <td>congruent</td>
      <td>0.533328</td>
      <td>False</td>
      <td>0.367119</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we can identify outliers as those rows where <code class="docutils literal notranslate"><span class="pre">rt_z</span> <span class="pre">&gt;</span> <span class="pre">2.5</span></code> or <code class="docutils literal notranslate"><span class="pre">rt_z</span> <span class="pre">&lt;</span> <span class="pre">-2.5</span></code>. We’ll define a variable <code class="docutils literal notranslate"><span class="pre">z_thresh</span></code> because that way we can later change it to a different value (like 3) if we desire.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z_thresh</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">z_thresh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       True
1       True
2       True
3       True
4       True
        ... 
4284    True
4285    True
4286    True
4287    True
4288    True
Name: rt_z, Length: 4289, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>More simply, we can take the absolute value of <em>z</em> (which ignores the <code class="docutils literal notranslate"><span class="pre">-</span></code> sign):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">z_thresh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       False
1       False
2       False
3       False
4       False
        ...  
4284    False
4285    False
4286    False
4287    False
4288     True
Name: rt_z, Length: 4289, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>The number of outliers identified this way is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>111
</pre></div>
</div>
</div>
</div>
<p>You’ll note that there are actually fewer outliers defined this way as using the 1.5 x IQR (Tukey) method. Why is this? As noted earlier, Tukey’s threshold and <em>z</em> &gt;= 2.5 are only approximately the same, so we expect minor differences. However, we noted that the 1.5 x IQR range is a bit <em>wider</em> than <em>z</em> &gt; 2.5, meaning it should capture more data points and <em>fewer</em> values should be identified as outliers by Tukey’s method. Yet yere, more are. The reason for this is that both Tukey’s and the standard score methods assume our data are normally distributed, when in fact they are skewed, with more values at the high (slow RT) end than at the low (fast RT) end. Since the data don’t fit the assumptions of the methods we used, we get unexpected results.</p>
<section id="write-column-of-standard-score-outliers">
<h4>Write column of standard score outliers<a class="headerlink" href="#write-column-of-standard-score-outliers" title="Permalink to this heading">#</a></h4>
<p>We’ll worry about skewness a little later, but for now we will add a column marking outliers as defined this way, similarly to what we did above for the Tukey method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">z_thresh</span>
<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
      <th>rt_z</th>
      <th>outliers_z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1143</th>
      <td>s21</td>
      <td>1</td>
      <td>31</td>
      <td>neutral</td>
      <td>0.478700</td>
      <td>False</td>
      <td>-0.166393</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3552</th>
      <td>s20</td>
      <td>2</td>
      <td>29</td>
      <td>neutral</td>
      <td>0.434146</td>
      <td>False</td>
      <td>-0.601518</td>
      <td>False</td>
    </tr>
    <tr>
      <th>460</th>
      <td>s16</td>
      <td>5</td>
      <td>13</td>
      <td>incongruent</td>
      <td>0.442151</td>
      <td>False</td>
      <td>-0.523338</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2850</th>
      <td>s10</td>
      <td>5</td>
      <td>26</td>
      <td>congruent</td>
      <td>0.465224</td>
      <td>False</td>
      <td>-0.298002</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2447</th>
      <td>s14</td>
      <td>3</td>
      <td>6</td>
      <td>congruent</td>
      <td>0.441861</td>
      <td>False</td>
      <td>-0.526171</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1528</th>
      <td>s1</td>
      <td>4</td>
      <td>4</td>
      <td>congruent</td>
      <td>0.393363</td>
      <td>False</td>
      <td>-0.999814</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The above <code class="docutils literal notranslate"><span class="pre">.sample()</span></code> is not likely to happen to sample outlier data points, but we can confirm their presence with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
      <th>rt_z</th>
      <th>outliers_z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26</th>
      <td>s25</td>
      <td>1</td>
      <td>27</td>
      <td>incongruent</td>
      <td>0.757437</td>
      <td>True</td>
      <td>2.555820</td>
      <td>True</td>
    </tr>
    <tr>
      <th>37</th>
      <td>s25</td>
      <td>2</td>
      <td>6</td>
      <td>neutral</td>
      <td>0.917223</td>
      <td>True</td>
      <td>4.116328</td>
      <td>True</td>
    </tr>
    <tr>
      <th>117</th>
      <td>s25</td>
      <td>4</td>
      <td>22</td>
      <td>incongruent</td>
      <td>0.817285</td>
      <td>True</td>
      <td>3.140311</td>
      <td>True</td>
    </tr>
    <tr>
      <th>227</th>
      <td>s18</td>
      <td>3</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.806528</td>
      <td>True</td>
      <td>3.035256</td>
      <td>True</td>
    </tr>
    <tr>
      <th>350</th>
      <td>s16</td>
      <td>1</td>
      <td>32</td>
      <td>incongruent</td>
      <td>0.762060</td>
      <td>True</td>
      <td>2.600971</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4208</th>
      <td>s15</td>
      <td>3</td>
      <td>16</td>
      <td>incongruent</td>
      <td>0.897641</td>
      <td>True</td>
      <td>3.925088</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4231</th>
      <td>s15</td>
      <td>4</td>
      <td>7</td>
      <td>congruent</td>
      <td>0.881503</td>
      <td>True</td>
      <td>3.767480</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4262</th>
      <td>s15</td>
      <td>5</td>
      <td>6</td>
      <td>incongruent</td>
      <td>0.853477</td>
      <td>True</td>
      <td>3.493770</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4279</th>
      <td>s15</td>
      <td>5</td>
      <td>23</td>
      <td>neutral</td>
      <td>0.845636</td>
      <td>True</td>
      <td>3.417194</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4288</th>
      <td>s15</td>
      <td>5</td>
      <td>32</td>
      <td>congruent</td>
      <td>0.789597</td>
      <td>True</td>
      <td>2.869903</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>111 rows × 8 columns</p>
</div></div></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="why-are-outliers-a-problem">
<h2>Why are outliers a problem?<a class="headerlink" href="#why-are-outliers-a-problem" title="Permalink to this heading">#</a></h2>
<p>Outliers are a problem because they have disproportionate <em>leverage</em> on statistical properties of the data, such as the mean and variance. We can see this by creating a small, simulated data set from a normal distribution, then replacing one value with either an extremely different or just slightly different data point. Let’s do this, and compare the means and standard deviations in each case. We use NumPy’s <code class="docutils literal notranslate"><span class="pre">np.random.default_rng().normal()</span></code> function to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create array with mean=0, standard deviation=1, and 10 data values</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of data with no outliers:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of data with no outliers:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: [-0.69001169 -0.22982861 -0.49019262  0.31457738  1.23747531 -2.72438508
  0.4163925   1.59502866 -1.01201596  0.57625276]
Mean of data with no outliers: -0.10067
Standard deviation of data with no outliers: 1.17449
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_not_extreme</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># replace last value in array with outlier</span>
<span class="n">data_not_extreme</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_not_extreme</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of data with minor outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_not_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of data with minor outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data_not_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: [-0.69001169 -0.22982861 -0.49019262  0.31457738  1.23747531 -2.72438508
  0.4163925   1.59502866 -1.01201596  3.        ]
Mean of data with minor outlier: 0.1417
Standard deviation of data with minor outlier: 1.49542
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_extreme</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># replace last value in array with outlier</span>
<span class="n">data_extreme</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of data with extreme outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of data with extreme outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: [-0.69001169 -0.22982861 -0.49019262  0.31457738  1.23747531 -2.72438508
  0.4163925   1.59502866 -1.01201596 10.        ]
Mean of data with extreme outlier: 0.8417
Standard deviation of data with extreme outlier: 3.26311
</pre></div>
</div>
</div>
</div>
<p>From the above we can see that a larger outlier has a larger impact on both the mean and variance of the data. Also remember, when looking at the information above, that the true population mean of the data (as specified in the arguments to the random number generator) is 0 and the true standard deviation is 1. Using this normal distribution makes it easy to see that outliers bias our statistics away from the true population mean and variance.</p>
<p>The impact of outliers is often less extreme — in the above examples, our data set comprised only 10 values, and so making one an outlier meant that 10% of data points were outliers — whereas by the definitions above, we would normally expect only 1–2% of data points to be outliers.</p>
<p>If we re-run the simulations with a data set of 100 values and one outlier, you can see that the impact of even an extreme outlier is much reduced:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create array with mean=0, standard deviation=1, and 10 data values</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of data with no outliers:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of data with no outliers:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: [ 0.5764744   1.67118267  0.06629779 -2.16117958 -1.3101306  -1.49693048
  1.64497733 -0.82164403 -0.7361967   0.60943011  3.18894493 -0.54568895
  0.88193548 -0.65294752  1.25483073 -1.93822734 -0.40544366 -1.52386663
  0.45651842 -0.32478319  0.00434174  0.38548977 -0.28787028  0.22231584
 -0.90080855  1.46823712 -0.5085243   1.80037706 -0.1770219  -0.71728407
 -0.24896951  0.35220893  0.54830998 -0.62058197 -1.96742915 -0.39425525
  0.31930912  0.95034623 -0.28733432 -0.19899788 -1.06273622  0.69231492
  0.39799287 -0.91437488 -0.16983325 -1.29328407  0.85739961 -0.32905272
  0.5892114   0.10090985  0.27987191 -0.62312293  0.32966256  0.62595753
  0.21765864 -0.68919815  2.21750235 -1.1989147   0.38291689 -1.2838092
  0.09357361  1.86157162 -0.69286905  0.98479536 -0.87800556 -0.58351637
  0.87142595 -1.73070263  0.87263861  1.04489315  0.63066151  0.81249103
  1.12060327 -1.1811406   0.29113393  0.37705931 -0.68129827  1.10247676
  1.68308832  1.12162851  0.72400858 -1.23781729  0.02871974  1.59716987
  0.34990383  1.95870707  1.8856098  -1.30315228  1.56183019 -0.52897248
 -1.36766669  1.53293119 -0.69109474  0.07638481 -0.49301776 -0.99140601
  0.80841781 -1.25415551 -1.29658819  0.19489113]
Mean of data with no outliers: 0.05978
Standard deviation of data with no outliers: 1.05701
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_extreme</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># replace last value in array with outlier</span>
<span class="n">data_extreme</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of data with extreme outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of data with extreme outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: [ 5.76474402e-01  1.67118267e+00  6.62977917e-02 -2.16117958e+00
 -1.31013060e+00 -1.49693048e+00  1.64497733e+00 -8.21644032e-01
 -7.36196702e-01  6.09430106e-01  3.18894493e+00 -5.45688954e-01
  8.81935483e-01 -6.52947522e-01  1.25483073e+00 -1.93822734e+00
 -4.05443655e-01 -1.52386663e+00  4.56518422e-01 -3.24783188e-01
  4.34173771e-03  3.85489769e-01 -2.87870282e-01  2.22315839e-01
 -9.00808546e-01  1.46823712e+00 -5.08524300e-01  1.80037706e+00
 -1.77021896e-01 -7.17284074e-01 -2.48969505e-01  3.52208932e-01
  5.48309980e-01 -6.20581970e-01 -1.96742915e+00 -3.94255249e-01
  3.19309119e-01  9.50346230e-01 -2.87334325e-01 -1.98997885e-01
 -1.06273622e+00  6.92314915e-01  3.97992869e-01 -9.14374878e-01
 -1.69833248e-01 -1.29328407e+00  8.57399607e-01 -3.29052724e-01
  5.89211402e-01  1.00909850e-01  2.79871908e-01 -6.23122929e-01
  3.29662561e-01  6.25957526e-01  2.17658638e-01 -6.89198153e-01
  2.21750235e+00 -1.19891470e+00  3.82916889e-01 -1.28380920e+00
  9.35736069e-02  1.86157162e+00 -6.92869052e-01  9.84795356e-01
 -8.78005563e-01 -5.83516365e-01  8.71425945e-01 -1.73070263e+00
  8.72638607e-01  1.04489315e+00  6.30661511e-01  8.12491033e-01
  1.12060327e+00 -1.18114060e+00  2.91133925e-01  3.77059309e-01
 -6.81298273e-01  1.10247676e+00  1.68308832e+00  1.12162851e+00
  7.24008580e-01 -1.23781729e+00  2.87197355e-02  1.59716987e+00
  3.49903829e-01  1.95870707e+00  1.88560980e+00 -1.30315228e+00
  1.56183019e+00 -5.28972483e-01 -1.36766669e+00  1.53293119e+00
 -6.91094742e-01  7.63848051e-02 -4.93017765e-01 -9.91406008e-01
  8.08417811e-01 -1.25415551e+00 -1.29658819e+00  1.00000000e+01]
Mean of data with extreme outlier: 0.15783
Standard deviation of data with extreme outlier: 1.4476
</pre></div>
</div>
</div>
</div>
<p>The impact of an individual outlier is thus dependent on the size of the data set, and indeed in many data sets comprising a large number of data points, the impact of one outlier (or even 1% of the data values being outliers) can be quite minimal.</p>
<p>However, the impact of an outlier is also proportionate to its size, relative to the other values in the data set. Here we use 100 as the anomalous value, rather than 10, again in a data set with 100 values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_extreme</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># replace last value in array with outlier</span>
<span class="n">data_extreme</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of data with extreme outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of data with extreme outlier:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data_extreme</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: [ 5.76474402e-01  1.67118267e+00  6.62977917e-02 -2.16117958e+00
 -1.31013060e+00 -1.49693048e+00  1.64497733e+00 -8.21644032e-01
 -7.36196702e-01  6.09430106e-01  3.18894493e+00 -5.45688954e-01
  8.81935483e-01 -6.52947522e-01  1.25483073e+00 -1.93822734e+00
 -4.05443655e-01 -1.52386663e+00  4.56518422e-01 -3.24783188e-01
  4.34173771e-03  3.85489769e-01 -2.87870282e-01  2.22315839e-01
 -9.00808546e-01  1.46823712e+00 -5.08524300e-01  1.80037706e+00
 -1.77021896e-01 -7.17284074e-01 -2.48969505e-01  3.52208932e-01
  5.48309980e-01 -6.20581970e-01 -1.96742915e+00 -3.94255249e-01
  3.19309119e-01  9.50346230e-01 -2.87334325e-01 -1.98997885e-01
 -1.06273622e+00  6.92314915e-01  3.97992869e-01 -9.14374878e-01
 -1.69833248e-01 -1.29328407e+00  8.57399607e-01 -3.29052724e-01
  5.89211402e-01  1.00909850e-01  2.79871908e-01 -6.23122929e-01
  3.29662561e-01  6.25957526e-01  2.17658638e-01 -6.89198153e-01
  2.21750235e+00 -1.19891470e+00  3.82916889e-01 -1.28380920e+00
  9.35736069e-02  1.86157162e+00 -6.92869052e-01  9.84795356e-01
 -8.78005563e-01 -5.83516365e-01  8.71425945e-01 -1.73070263e+00
  8.72638607e-01  1.04489315e+00  6.30661511e-01  8.12491033e-01
  1.12060327e+00 -1.18114060e+00  2.91133925e-01  3.77059309e-01
 -6.81298273e-01  1.10247676e+00  1.68308832e+00  1.12162851e+00
  7.24008580e-01 -1.23781729e+00  2.87197355e-02  1.59716987e+00
  3.49903829e-01  1.95870707e+00  1.88560980e+00 -1.30315228e+00
  1.56183019e+00 -5.28972483e-01 -1.36766669e+00  1.53293119e+00
 -6.91094742e-01  7.63848051e-02 -4.93017765e-01 -9.91406008e-01
  8.08417811e-01 -1.25415551e+00 -1.29658819e+00  1.00000000e+02]
Mean of data with extreme outlier: 1.05783
Standard deviation of data with extreme outlier: 10.00007
</pre></div>
</div>
</div>
</div>
<p>Now the impact of this 1% of the data is much more extreme. In some data sets, it is unlikely or even impossible to have very extreme outliers. For example, in the Flanker study we’re working with, the lower bound of RT is 0, and the upper bound is 1000 ms, because if a participant didn’t make a response iwthin 1 s of the stimulus, the trial automatically ended without recording a response. However, in some data sets more extreme values are possible. For example, a technical problem with a neuroimaging system, such as EEG or single-unit recording electrodes, could result in very extreme values relative to normal physiologically-plausible values.</p>
</section>
<section id="which-method-to-use">
<h2>Which method to use?<a class="headerlink" href="#which-method-to-use" title="Permalink to this heading">#</a></h2>
<p>If you look at the image idescribing the Tukey method above, you can see that the range of the distribution covered by <span class="math notranslate nohighlight">\(1.5 x IQR\)</span> is just slightly larger than 2.5 <span class="math notranslate nohighlight">\(\sigma\)</span>. So, the Tukey method is roughly equivalent to using a <em>z</em> threshold of ±2.5. The <span class="math notranslate nohighlight">\(1.5 x IQR\)</span> range is slightly wider than <em>z</em> = 2.5, and so may on average identify slightly fewer data points as outliers, but the result is probably negligible in practice. However, many researchers use <em>z</em> &gt; 3 as their threshold for outliers, which will tend to identify fewer outliers than the Tukey method.</p>
<p>Since box plots are a great — and well-known — way of visualizing data distributions, there is a logic to using the <span class="math notranslate nohighlight">\(1.5 x IQR\)</span> method to identify outliers since the results will be consistent. However, the approximate equivalence between the Tukey method and <em>z</em> = 2.5 is <em>only true if the data are normally distributed</em>. For skewed data, like RT data, this method may exclude too many outliers. In particular, it will tend to exclude more long RT values than short RT values, even though many of the long RT values are likely valid (especially in a case like the present experiment, where trials were cut off at 1 s, preventing really long RTs).</p>
<section id="an-empirical-study-addressing-outlier-removal-with-rt-data">
<h3>An empirical study addressing outlier removal with RT data<a class="headerlink" href="#an-empirical-study-addressing-outlier-removal-with-rt-data" title="Permalink to this heading">#</a></h3>
<p>Berger and Kiefer (<a class="reference external" href="https://doi.org/10.3389/fpsyg.2021.675558">2021</a>) performed a study in which they simulated many samples of reaction times, and introduced either more- or less-extreme outliers into the data. Essentially this was a more sophisticated version of the simulations shown above, and using the natural properties of RT data, and simulating an experiment with different conditions. Berger and Kiefer compared Tukey’s method, the <em>z</em> transform method using thresholds of both 2 and 3, and several other methods, as well as simply leaving outliers in the data. Since this was simulated data, the authors knew the true values of the mean and standard deviation in each data set, which allowed them to compare each method to the “truth” — something we never have the luxury of knowing in experimental psychology and neuroscience.</p>
<p>Berger and Kiefer found that the <em>z</em> transform method was the best choice. With RT data, as noted above, Tukey’s method excluded too many data points on the long-RT side of the distribution. This had two negative impacts: firstly, it made the data appear more normally distributed than it really was, and secondly, it biased the statistical analyses towards false positives (Type 1 errors) — finding statistically significant differences between conditions when they were not present in the “true” data. Berger and Kiefer also observed that <em>not</em> rejecting outliers was the worst choice. The outliers led to a high rate of false negative results (Type 2 errors), meaning that true differences between conditions were not found to be statistically significant, due to the presence of outliers.</p>
<p>The <em>z</em> transform was not perfect (and we cannot expect any method to be), but it was more balanced in not rejecting disproportionately more long RTs than short RTs, rejecting fewer data points overall, and biasing the statistical analyses the least. Since in general, with experimental data we want to only exclude truly anomalous data points, I suggest using a <em>z</em> threshold of 3 for outlier removal. Using a threshold of 2 or 2.5 will naturally exclude more data points, increasing the likelihood that valid data is excluded.</p>
<p>It’s also important to note that trying different outlier removal methods on a real data set, or even different <em>z</em> thresholds to define outliers, introduces a component of <em>researcher bias</em> (or <em>researcher degrees of freedom</em>) into the analysis. Once you start doing this, it because easy to choose a method based on what “looks right” — which is, ultimately, what the researcher <em>thinks</em> the data should look like, not the true nature of the data. For this reason, parameters such as outlier definition method and threshold should be chosen prior to performing the analyses (ideally, <span class="xref myst">preregistering</span> the plan even before running the experiment).</p>
</section>
</section>
<hr class="docutils" />
<section id="what-to-do-with-outliers">
<h2>What to do with outliers<a class="headerlink" href="#what-to-do-with-outliers" title="Permalink to this heading">#</a></h2>
<p>We have three basic options for outliers:</p>
<ol class="arabic simple">
<li><p>Ignore them — just include them in the data and all analyses</p></li>
<li><p>Remove them completely from the DataFrame</p></li>
<li><p>Replace them with non-outlier values</p></li>
</ol>
<section id="ignore-them">
<h3>1. Ignore them<a class="headerlink" href="#ignore-them" title="Permalink to this heading">#</a></h3>
<p>Some scientists fundamentally do not believe in rejecting outliers. In working with data from human or animal participants, one can argue that any behavioural response is possibly valid, and outliers may represent interesting data points for any number of reasons (e.g., an exceptionally slow RT may mean the person spent a lot of time thinking about the stimulus and trying to decide on a response).</p>
<p>Another reason to consider not removing outliers (or using some other definition of outliers) is if the data are not actually normally distributed. Indeed, the RT data we have been working with are not normally distributed, they are skewed - an issue which we will address below. Skew is a relatively minor violation of normality. More generally, although the normal distribution is very common in nature, not all data is normally distributed, and so it is worth examining the distribution of your data (one reason we spend so much time looking at box plots, histograms, and other visualizations of distributions).</p>
<p>On the other hand, outliers can arise for reasons that really aren’t of experimental interest (<a class="reference external" href="https://doi.org/10.1037/h0083285">McCormack &amp; Wright, 1964)</a>. For instance, in the present data set we have a few very short RTs from true measurement error. In the box plot of the data, we can see 2–3 data points in each flanker condition below 100–200 ms. It is nearly impossible for a typical human to respond to a stimulus in less than this amount of time, particularly when some decision (like which way an arrow is pointing) is required first (<a class="reference external" href="https://dx.doi.org/10.1093/acprof:oso/9780195070019.001.0001">Luce, 1991</a>; <a class="reference external" href="https://dx.doi.org/10.1007/BF03395630">Whelan, 2008</a>). So rather than being scientifically interesting, these outliers probably reflect trials when the participant accidentally pressed a response button. Likewise, exceptionally long RTs could reflect trials on which the participant thought they pressed the button then realized they didn’t, trials where the participant got distracted, or sneezed and didn’t see the stimulus, etc.. As noted above, Berger and Kiefer (2021) found that not rejecting outliers decreased the likelihood of finding statistically significant differences, when those differences were actually present in the data.</p>
<p>My general advice is not to ignore outliers, unless you have strong, principled reasons as to why outliers might be interesting (or not actually outliers, if the distribution is not normal) and how you would interpret them.</p>
</section>
<section id="remove-them-from-the-data-set">
<h3>2. Remove them from the data set<a class="headerlink" href="#remove-them-from-the-data-set" title="Permalink to this heading">#</a></h3>
<p>Removing data points — known as <strong>trimming</strong> or <strong>truncation</strong> — is acceptable in some cases, but problematic in others. For repeated measures data, it’s often fine to remove outliers at the individual participant level, since we have many other samples of the measurement (i.e., the repeated measures, such as trials). On the other hand, if we only have one measurement for a particular “unit” of the experimental design (e.g., one measurement from each participant, in each condition), then we might not want to completely lose that data point. This is especially true for data that will be analyzed statistically with a <em>t</em> test or ANOVA, because these methods cannot handle missing values.</p>
</section>
<section id="replace-them-with-non-outlier-values">
<h3>3. Replace them with non-outlier values<a class="headerlink" href="#replace-them-with-non-outlier-values" title="Permalink to this heading">#</a></h3>
<p>Another approach to dealing with outliers is to replace them with a less-outlying value. This could be the mean value, or the most extreme value that is not considered an outlier. Replacing an outlier with the mean value basically “neutralizes” that data point, since it is equivalent to the mean it doesn’t alter the mean  of the data points. However, it does artificially reduce the variance in the data a bit, because variance is, by definition, the amount by which any data point differs from the mean. But if you are only replacing 1–2% of your data values, the impact on variance should be fairly small. Also note that, properly, the mean that is used as the replacement value should be computed only from all of the <em>non-outlier</em> data values. This is because a major reason to replace or remove outliers in the first place is that they have disproportionate influence on the mean.</p>
<p>Replacing the outlier with the most-extreme non-outlier value will preserve variance contributed by that data point, but reduce the variance relative to retaining the outlier value. Likewise, the impact on the mean will not be neutral, but it will be rather small. Note that an assumption of replacing the outlier value with another, relatively extreme (relative to the mean), value is that the outlier was actually a valid measurement, perhaps with some noise in it. Since we don’t know for sure what the true value of the data was, in principle it seems better to replace outliers with the mean.</p>
</section>
</section>
<section id="replacing-outliers-with-mean-values">
<h2>Replacing outliers with mean values<a class="headerlink" href="#replacing-outliers-with-mean-values" title="Permalink to this heading">#</a></h2>
<p>Based on the information above, we will approach outliers in the Flanker data set by applying a <em>z</em> transform, defining outliers as those values with <span class="math notranslate nohighlight">\(\lvert z \lvert \gt 3\)</span>, and replace these values with the mean (where the mean is calculated excluding the outlier values).</p>
<p>First, as we did above, we’ll define <code class="docutils literal notranslate"><span class="pre">z_thresh</span></code> as 3 and fill the <code class="docutils literal notranslate"><span class="pre">outliers_z</span></code> column with <code class="docutils literal notranslate"><span class="pre">True</span></code> where <span class="math notranslate nohighlight">\(\lvert z \lvert \gt 3\)</span> and <code class="docutils literal notranslate"><span class="pre">False</span></code> for all other rows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z_thresh</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">z_thresh</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll create a column containing the mean RT. To exclude the outlier values in computing this, we select only the rows where <code class="docutils literal notranslate"><span class="pre">outliers_z</span></code> is False:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">][</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
      <th>rt_z</th>
      <th>outliers_z</th>
      <th>rt_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s25</td>
      <td>1</td>
      <td>1</td>
      <td>congruent</td>
      <td>0.652072</td>
      <td>False</td>
      <td>1.526800</td>
      <td>False</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s25</td>
      <td>1</td>
      <td>2</td>
      <td>neutral</td>
      <td>0.644872</td>
      <td>False</td>
      <td>1.456483</td>
      <td>False</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s25</td>
      <td>1</td>
      <td>3</td>
      <td>congruent</td>
      <td>0.445182</td>
      <td>False</td>
      <td>-0.493736</td>
      <td>False</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s25</td>
      <td>1</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.525200</td>
      <td>False</td>
      <td>0.287737</td>
      <td>False</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s25</td>
      <td>1</td>
      <td>5</td>
      <td>congruent</td>
      <td>0.533328</td>
      <td>False</td>
      <td>0.367119</td>
      <td>False</td>
      <td>0.49191</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Finally, we fill a new column, <code class="docutils literal notranslate"><span class="pre">rt_clean</span></code>, with either the original RT value (for non-outliers), or the mean RT (for outliers). The way that we create a new pandas column, contingent on the values of another column, is using the <code class="docutils literal notranslate"><span class="pre">np.where()</span></code> function. This is essentially a way of running an <code class="docutils literal notranslate"><span class="pre">if-else</span></code> conditional statement on each row in a pandas column. <code class="docutils literal notranslate"><span class="pre">np.where()</span></code> takes three arguments, which are (in order), the conditional statement, the value to fill in the new column if the conditional is true, and finally the value to fill in if the conditional is false.</p>
<p>So the code below tests, for each row, whether <code class="docutils literal notranslate"><span class="pre">outliers_z</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>. If it is (i.e., an outlier), the mean RT is filled in; otherwise the original RT value for that trial is copied to the <code class="docutils literal notranslate"><span class="pre">clean_rt</span></code> column. The three arguments to <code class="docutils literal notranslate"><span class="pre">np.where()</span></code> are each shown on their own line, to make it a little more readable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_clean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> 
                          <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">],</span> 
                          <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
      <th>rt_z</th>
      <th>outliers_z</th>
      <th>rt_mean</th>
      <th>rt_clean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s25</td>
      <td>1</td>
      <td>1</td>
      <td>congruent</td>
      <td>0.652072</td>
      <td>False</td>
      <td>1.526800</td>
      <td>False</td>
      <td>0.49191</td>
      <td>0.652072</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s25</td>
      <td>1</td>
      <td>2</td>
      <td>neutral</td>
      <td>0.644872</td>
      <td>False</td>
      <td>1.456483</td>
      <td>False</td>
      <td>0.49191</td>
      <td>0.644872</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s25</td>
      <td>1</td>
      <td>3</td>
      <td>congruent</td>
      <td>0.445182</td>
      <td>False</td>
      <td>-0.493736</td>
      <td>False</td>
      <td>0.49191</td>
      <td>0.445182</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s25</td>
      <td>1</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.525200</td>
      <td>False</td>
      <td>0.287737</td>
      <td>False</td>
      <td>0.49191</td>
      <td>0.525200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s25</td>
      <td>1</td>
      <td>5</td>
      <td>congruent</td>
      <td>0.533328</td>
      <td>False</td>
      <td>0.367119</td>
      <td>False</td>
      <td>0.49191</td>
      <td>0.533328</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Although the first few rows in this DataFrame were not identified as outliers, we can confirm that this procedure worked by filtering the DataFrame to only show us rows where <code class="docutils literal notranslate"><span class="pre">outliers_z</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>outliers_tukey</th>
      <th>rt_z</th>
      <th>outliers_z</th>
      <th>rt_mean</th>
      <th>rt_clean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>37</th>
      <td>s25</td>
      <td>2</td>
      <td>6</td>
      <td>neutral</td>
      <td>0.917223</td>
      <td>True</td>
      <td>4.116328</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>117</th>
      <td>s25</td>
      <td>4</td>
      <td>22</td>
      <td>incongruent</td>
      <td>0.817285</td>
      <td>True</td>
      <td>3.140311</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>227</th>
      <td>s18</td>
      <td>3</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.806528</td>
      <td>True</td>
      <td>3.035256</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>518</th>
      <td>s22</td>
      <td>2</td>
      <td>7</td>
      <td>incongruent</td>
      <td>0.817863</td>
      <td>True</td>
      <td>3.145955</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>841</th>
      <td>s8</td>
      <td>2</td>
      <td>11</td>
      <td>congruent</td>
      <td>0.056265</td>
      <td>True</td>
      <td>-4.291995</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4195</th>
      <td>s15</td>
      <td>3</td>
      <td>3</td>
      <td>congruent</td>
      <td>0.853705</td>
      <td>True</td>
      <td>3.495996</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>4208</th>
      <td>s15</td>
      <td>3</td>
      <td>16</td>
      <td>incongruent</td>
      <td>0.897641</td>
      <td>True</td>
      <td>3.925088</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>4231</th>
      <td>s15</td>
      <td>4</td>
      <td>7</td>
      <td>congruent</td>
      <td>0.881503</td>
      <td>True</td>
      <td>3.767480</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>4262</th>
      <td>s15</td>
      <td>5</td>
      <td>6</td>
      <td>incongruent</td>
      <td>0.853477</td>
      <td>True</td>
      <td>3.493770</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
    <tr>
      <th>4279</th>
      <td>s15</td>
      <td>5</td>
      <td>23</td>
      <td>neutral</td>
      <td>0.845636</td>
      <td>True</td>
      <td>3.417194</td>
      <td>True</td>
      <td>0.49191</td>
      <td>0.49191</td>
    </tr>
  </tbody>
</table>
<p>66 rows × 10 columns</p>
</div></div></div>
</div>
<section id="reporting-outlier-rejections">
<h3>Reporting outlier rejections<a class="headerlink" href="#reporting-outlier-rejections" title="Permalink to this heading">#</a></h3>
<p>In any report describing your data, you should state:</p>
<ul class="simple">
<li><p>the method you used to identify outliers</p></li>
<li><p>how you dealt with outliers</p></li>
<li><p>what proportion of the data were identified as outliers, and thus treated</p></li>
</ul>
<p>To get this last value, we can simply compute the number of <code class="docutils literal notranslate"><span class="pre">True</span></code> values in <code class="docutils literal notranslate"><span class="pre">outliers_z</span></code>, divided by the total number of trials (rows):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;outliers_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c1"># Convert proportion to percent, and round to 2 decimal places</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">outliers</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the data identified as outliers and replaced with mean value.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.54 % of the data identified as outliers and replaced with mean value.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="working-with-nested-data">
<h2>Working with nested data<a class="headerlink" href="#working-with-nested-data" title="Permalink to this heading">#</a></h2>
<p>All of the above was correct, for data without nesting or repeated measures. The reason for this caveat is that with nested data, what constitutes an “outlier” for one source of data (e.g., one participant) may be a very reasonable value for another person. This is perhaps most intuitive if we think about an experiment comparing older and younger adults. With age, RTs on average get longer. So slow RT that is an outlier for an 18 year old university student may be about the average RT for someone who is 80 years old.</p>
<p>To properly address the nested structure of data in identifying and correcting outliers, we can use the same steps as above, but using the split-apply-combine approach provided by pandas <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> method. In other words, we split the data by participant, apply the outlier detection and correction steps, and then combine the data into a new column in the DataFrame.</p>
<div class="alert alert-block alert-info">
<p>The code below is probably the most complex that we’ve worked with so far. Take your time going through this, and try to understand it as fully as you can. It may seem like a convoluted series of steps, but they are a logical sequence and each one is optimized for pandas. This is in fact <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#transformation">pandas’ suggested approach for outlier correction</a></p>
</div>
<p>Since we’ve added lots of columns above, let’s start fresh by re-loading the DataFrame from the file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/flanker_rt_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="compute-z-scores-by-participant">
<h3>Compute <em>z</em> scores by participant<a class="headerlink" href="#compute-z-scores-by-participant" title="Permalink to this heading">#</a></h3>
<p>Now let’s split by participant and apply the <em>z</em> transform to the split data. Pandas has a useful method, <code class="docutils literal notranslate"><span class="pre">.transform()</span></code>, that allows us to run a non-pandas function on a selection from a DataFrame. So we group by participant, select only the <code class="docutils literal notranslate"><span class="pre">rt</span></code> column to operate on, and then <code class="docutils literal notranslate"><span class="pre">.transform(stats.zscore)</span></code> and assign this to a new column in the DataFrame, <code class="docutils literal notranslate"><span class="pre">rt_z</span></code>. Note that when we pass a function to <code class="docutils literal notranslate"><span class="pre">.apply()</span></code>, we <em>do not</em> put parentheses after the name of the function we are using. That is, if we were running <code class="docutils literal notranslate"><span class="pre">stats.zscore</span></code> on its own (see above), we would use <code class="docutils literal notranslate"><span class="pre">stats.zscore(df['rt'])</span></code>. But since the we have already selected the data that we are passing with <code class="docutils literal notranslate"><span class="pre">.transform()</span></code>, we don’t use the parentheses with the function call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;participant&#39;</span><span class="p">)[</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>rt_z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2117</th>
      <td>s9</td>
      <td>2</td>
      <td>26</td>
      <td>incongruent</td>
      <td>0.420741</td>
      <td>-0.182349</td>
    </tr>
    <tr>
      <th>3113</th>
      <td>s23</td>
      <td>4</td>
      <td>2</td>
      <td>congruent</td>
      <td>0.517965</td>
      <td>-0.316636</td>
    </tr>
    <tr>
      <th>1883</th>
      <td>s7</td>
      <td>5</td>
      <td>14</td>
      <td>incongruent</td>
      <td>0.643147</td>
      <td>0.129230</td>
    </tr>
    <tr>
      <th>2132</th>
      <td>s9</td>
      <td>3</td>
      <td>9</td>
      <td>neutral</td>
      <td>0.437718</td>
      <td>0.060284</td>
    </tr>
    <tr>
      <th>661</th>
      <td>s11</td>
      <td>1</td>
      <td>22</td>
      <td>neutral</td>
      <td>0.405618</td>
      <td>-0.668835</td>
    </tr>
    <tr>
      <th>3443</th>
      <td>s3</td>
      <td>4</td>
      <td>16</td>
      <td>congruent</td>
      <td>0.497133</td>
      <td>-0.813839</td>
    </tr>
    <tr>
      <th>4060</th>
      <td>s5</td>
      <td>3</td>
      <td>28</td>
      <td>congruent</td>
      <td>0.474337</td>
      <td>-0.348236</td>
    </tr>
    <tr>
      <th>3596</th>
      <td>s20</td>
      <td>4</td>
      <td>9</td>
      <td>incongruent</td>
      <td>0.334045</td>
      <td>-1.949304</td>
    </tr>
    <tr>
      <th>3056</th>
      <td>s23</td>
      <td>2</td>
      <td>8</td>
      <td>neutral</td>
      <td>0.541864</td>
      <td>-0.095699</td>
    </tr>
    <tr>
      <th>1046</th>
      <td>s24</td>
      <td>3</td>
      <td>27</td>
      <td>incongruent</td>
      <td>0.556848</td>
      <td>-0.290334</td>
    </tr>
    <tr>
      <th>3821</th>
      <td>s19</td>
      <td>1</td>
      <td>12</td>
      <td>congruent</td>
      <td>0.612856</td>
      <td>0.489055</td>
    </tr>
    <tr>
      <th>3206</th>
      <td>s27</td>
      <td>1</td>
      <td>32</td>
      <td>neutral</td>
      <td>0.445412</td>
      <td>-0.225945</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="compute-mean-rt-from-valid-trials-for-each-participant">
<h3>Compute mean RT from valid trials for each participant<a class="headerlink" href="#compute-mean-rt-from-valid-trials-for-each-participant" title="Permalink to this heading">#</a></h3>
<p>Likewise, we need to compute the mean RT within participants, so again we could split by participant and then compute the within-participant mean, this time passing <code class="docutils literal notranslate"><span class="pre">np.mean</span></code> to <code class="docutils literal notranslate"><span class="pre">.transform()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;participant&#39;</span><span class="p">)[</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
<p>But actually, doing the above computes the mean across all trials for each participant — including the outlier trials. We can compute the mean across only the non-outlier trials by adding a filter  on <code class="docutils literal notranslate"><span class="pre">df</span></code> prior to the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> operation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">z_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;participant&#39;</span><span class="p">)[</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/9s/6fvdmxlx00z9sz6ftkrnh8dw0000gn/T/ipykernel_46059/4280679880.py:1: FutureWarning: The provided callable &lt;function mean at 0x103c98720&gt; is currently using SeriesGroupBy.mean. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string &quot;mean&quot; instead.
  df[&#39;rt_mean&#39;] = df[np.abs(df[&#39;rt_z&#39;]) &lt;= z_thresh].groupby(&#39;participant&#39;)[&#39;rt&#39;].transform(np.mean)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>rt_z</th>
      <th>rt_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s25</td>
      <td>1</td>
      <td>1</td>
      <td>congruent</td>
      <td>0.652072</td>
      <td>1.822298</td>
      <td>0.475143</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s25</td>
      <td>1</td>
      <td>2</td>
      <td>neutral</td>
      <td>0.644872</td>
      <td>1.746028</td>
      <td>0.475143</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s25</td>
      <td>1</td>
      <td>3</td>
      <td>congruent</td>
      <td>0.445182</td>
      <td>-0.369295</td>
      <td>0.475143</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s25</td>
      <td>1</td>
      <td>4</td>
      <td>neutral</td>
      <td>0.525200</td>
      <td>0.478337</td>
      <td>0.475143</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s25</td>
      <td>1</td>
      <td>5</td>
      <td>congruent</td>
      <td>0.533328</td>
      <td>0.564439</td>
      <td>0.475143</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="fill-in-mean-values-for-outlier-rows">
<h3>Fill in mean values for outlier rows<a class="headerlink" href="#fill-in-mean-values-for-outlier-rows" title="Permalink to this heading">#</a></h3>
<p>There’s a catch with this however — since we grouped <em>filtered</em> <code class="docutils literal notranslate"><span class="pre">np.abs(df['rt_z'])</span> <span class="pre">&lt;=</span> <span class="pre">z_thresh</span></code> data, this only fills in the <em>non-outlier</em> rows with mean RT, because those are the only rows that get passed to the <code class="docutils literal notranslate"><span class="pre">.transform()</span></code> method. The <code class="docutils literal notranslate"><span class="pre">mean_RT</span></code> rows where <em>z</em> exceeds outlier threshold are filled with <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, since pandas doesn’t know what else to do with them. We can see this if we ask for a sample of just the rows that exceed the outlier threshold:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># view sample of rows to confirm RT varies by participant</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>rt_z</th>
      <th>rt_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1598</th>
      <td>s13</td>
      <td>1</td>
      <td>10</td>
      <td>incongruent</td>
      <td>0.688901</td>
      <td>3.632997</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3319</th>
      <td>s27</td>
      <td>5</td>
      <td>17</td>
      <td>incongruent</td>
      <td>0.773004</td>
      <td>3.873254</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1299</th>
      <td>s2</td>
      <td>1</td>
      <td>28</td>
      <td>neutral</td>
      <td>0.837920</td>
      <td>4.414282</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2695</th>
      <td>s4</td>
      <td>5</td>
      <td>30</td>
      <td>incongruent</td>
      <td>0.657840</td>
      <td>4.418124</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2440</th>
      <td>s14</td>
      <td>2</td>
      <td>31</td>
      <td>neutral</td>
      <td>0.701127</td>
      <td>3.621617</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3769</th>
      <td>s17</td>
      <td>4</td>
      <td>23</td>
      <td>incongruent</td>
      <td>0.778205</td>
      <td>4.073122</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3108</th>
      <td>s23</td>
      <td>3</td>
      <td>28</td>
      <td>incongruent</td>
      <td>0.877870</td>
      <td>3.010529</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1151</th>
      <td>s21</td>
      <td>2</td>
      <td>7</td>
      <td>incongruent</td>
      <td>0.750666</td>
      <td>3.288323</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>602</th>
      <td>s22</td>
      <td>4</td>
      <td>27</td>
      <td>incongruent</td>
      <td>0.701941</td>
      <td>3.182802</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2926</th>
      <td>s6</td>
      <td>3</td>
      <td>6</td>
      <td>congruent</td>
      <td>0.889037</td>
      <td>3.237846</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To fix this, we need to group the data by participant again, except this time not excluding outlier rows. Then, we need to replace all NaNs in the <code class="docutils literal notranslate"><span class="pre">rt_mean</span></code> column with the mean RT for that participant.</p>
<p>To do this, we run another <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> + <code class="docutils literal notranslate"><span class="pre">.transform()</span></code> operation, but this time applying a more complex transformation using a <a class="reference external" href="https://www.datacamp.com/community/tutorials/python-lambda"><strong>lambda function</strong></a>. Lambda functions are basically a way of writing a small Python function inside a command. They are used when what you need to do is a bit more complex or specific than can be done with an existing method or function.</p>
<p>In this case, what we want to do is group <code class="docutils literal notranslate"><span class="pre">df</span></code> by participant ID, then fill in the NaN values with the mean RT from all non-NaN values for that participant. We do this by applying two operations in sequence: first we use <code class="docutils literal notranslate"><span class="pre">np.nanmean()</span></code> to compute the mean over all non-NaN RT values for that participant, and then we pass that value to <code class="docutils literal notranslate"><span class="pre">.fillna()</span></code> to replace any NaN values for that participant with the mean RT. This works because the <code class="docutils literal notranslate"><span class="pre">x</span></code> in the lambda function is a variable that refers to the entire grouped data set that we pass to it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;participant&#39;</span><span class="p">)[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="c1"># Check by again printing a smaple of outlier rows</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>rt_z</th>
      <th>rt_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2262</th>
      <td>s26</td>
      <td>2</td>
      <td>12</td>
      <td>incongruent</td>
      <td>0.840871</td>
      <td>3.309630</td>
      <td>0.550074</td>
    </tr>
    <tr>
      <th>3302</th>
      <td>s27</td>
      <td>4</td>
      <td>32</td>
      <td>incongruent</td>
      <td>0.728959</td>
      <td>3.322114</td>
      <td>0.457454</td>
    </tr>
    <tr>
      <th>2087</th>
      <td>s9</td>
      <td>1</td>
      <td>28</td>
      <td>congruent</td>
      <td>0.646603</td>
      <td>3.045625</td>
      <td>0.430409</td>
    </tr>
    <tr>
      <th>1598</th>
      <td>s13</td>
      <td>1</td>
      <td>10</td>
      <td>incongruent</td>
      <td>0.688901</td>
      <td>3.632997</td>
      <td>0.453831</td>
    </tr>
    <tr>
      <th>3612</th>
      <td>s20</td>
      <td>4</td>
      <td>25</td>
      <td>neutral</td>
      <td>0.754067</td>
      <td>3.132075</td>
      <td>0.489359</td>
    </tr>
    <tr>
      <th>4231</th>
      <td>s15</td>
      <td>4</td>
      <td>7</td>
      <td>congruent</td>
      <td>0.881503</td>
      <td>3.046180</td>
      <td>0.557696</td>
    </tr>
    <tr>
      <th>1296</th>
      <td>s2</td>
      <td>1</td>
      <td>25</td>
      <td>incongruent</td>
      <td>0.745997</td>
      <td>3.284224</td>
      <td>0.474832</td>
    </tr>
    <tr>
      <th>2076</th>
      <td>s9</td>
      <td>1</td>
      <td>17</td>
      <td>incongruent</td>
      <td>0.705617</td>
      <td>3.889038</td>
      <td>0.430409</td>
    </tr>
    <tr>
      <th>495</th>
      <td>s22</td>
      <td>1</td>
      <td>16</td>
      <td>incongruent</td>
      <td>0.722015</td>
      <td>3.428305</td>
      <td>0.431980</td>
    </tr>
    <tr>
      <th>4208</th>
      <td>s15</td>
      <td>3</td>
      <td>16</td>
      <td>incongruent</td>
      <td>0.897641</td>
      <td>3.201033</td>
      <td>0.557696</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="alert alert-block alert-info">
<p>If you don’t fully understand the lambda function above, that’s OK. It is fairly advanced relative to most of what we’ve covered so far. However, it’s introduced here because it is the proper and efficient way to replace outlier values. It’s also worth knowing about lambda functions because you will start seeing them more in the future!</p>
</div></section>
<section id="create-final-output-column">
<h3>Create final output column<a class="headerlink" href="#create-final-output-column" title="Permalink to this heading">#</a></h3>
<p>Next, we want to create a column called <code class="docutils literal notranslate"><span class="pre">rt_clean</span></code> that contains the original RT for non-outlier trials, and the mean RT for that participant for outlier trials. We can use <code class="docutils literal notranslate"><span class="pre">np.where()</span></code> to find outliers and replace them with each individual’s mean RT. Below, we do this in one line of code, which is more compact and efficient than we did above. Earlier, we first created a column, <code class="docutils literal notranslate"><span class="pre">outliers_z</span></code> and then used that to determine which rows would be filled with the original RT versus the mean RT. However, creating a column in our DataFrame that we will never use again is not efficient use of resources. Here we simply use the threshold test as our conditional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_clean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">,</span> 
                          <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_mean&#39;</span><span class="p">],</span> 
                          <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>rt_z</th>
      <th>rt_mean</th>
      <th>rt_clean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3971</th>
      <td>s5</td>
      <td>1</td>
      <td>3</td>
      <td>incongruent</td>
      <td>0.610068</td>
      <td>1.452782</td>
      <td>0.499061</td>
      <td>0.610068</td>
    </tr>
    <tr>
      <th>2277</th>
      <td>s26</td>
      <td>2</td>
      <td>27</td>
      <td>incongruent</td>
      <td>0.609159</td>
      <td>0.633223</td>
      <td>0.550074</td>
      <td>0.609159</td>
    </tr>
    <tr>
      <th>3742</th>
      <td>s17</td>
      <td>3</td>
      <td>28</td>
      <td>incongruent</td>
      <td>0.478108</td>
      <td>0.033763</td>
      <td>0.473696</td>
      <td>0.478108</td>
    </tr>
    <tr>
      <th>961</th>
      <td>s24</td>
      <td>1</td>
      <td>3</td>
      <td>neutral</td>
      <td>0.580368</td>
      <td>-0.048874</td>
      <td>0.581082</td>
      <td>0.580368</td>
    </tr>
    <tr>
      <th>1909</th>
      <td>s12</td>
      <td>1</td>
      <td>9</td>
      <td>congruent</td>
      <td>0.356792</td>
      <td>-1.650306</td>
      <td>0.490843</td>
      <td>0.356792</td>
    </tr>
    <tr>
      <th>1857</th>
      <td>s7</td>
      <td>4</td>
      <td>17</td>
      <td>congruent</td>
      <td>0.657764</td>
      <td>0.263626</td>
      <td>0.626862</td>
      <td>0.657764</td>
    </tr>
    <tr>
      <th>2474</th>
      <td>s14</td>
      <td>4</td>
      <td>1</td>
      <td>congruent</td>
      <td>0.444796</td>
      <td>-0.078688</td>
      <td>0.446461</td>
      <td>0.444796</td>
    </tr>
    <tr>
      <th>1626</th>
      <td>s13</td>
      <td>2</td>
      <td>6</td>
      <td>incongruent</td>
      <td>0.448985</td>
      <td>-0.098210</td>
      <td>0.453831</td>
      <td>0.448985</td>
    </tr>
    <tr>
      <th>185</th>
      <td>s18</td>
      <td>1</td>
      <td>26</td>
      <td>congruent</td>
      <td>0.518414</td>
      <td>0.036031</td>
      <td>0.513467</td>
      <td>0.518414</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>s12</td>
      <td>4</td>
      <td>27</td>
      <td>neutral</td>
      <td>0.542023</td>
      <td>0.596020</td>
      <td>0.490843</td>
      <td>0.542023</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Since a random sample of 10 rows may not show any where <em>z</em> actually exceeded our outlier threshold, we can use filtering to view only those rows where the absolute value of <em>z</em> was greater than our threshold, to confirm that in those rows <code class="docutils literal notranslate"><span class="pre">rt_clean</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">rt_mean</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>block</th>
      <th>trial</th>
      <th>flankers</th>
      <th>rt</th>
      <th>rt_z</th>
      <th>rt_mean</th>
      <th>rt_clean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3612</th>
      <td>s20</td>
      <td>4</td>
      <td>25</td>
      <td>neutral</td>
      <td>0.754067</td>
      <td>3.132075</td>
      <td>0.489359</td>
      <td>0.489359</td>
    </tr>
    <tr>
      <th>1078</th>
      <td>s24</td>
      <td>4</td>
      <td>28</td>
      <td>neutral</td>
      <td>0.888508</td>
      <td>3.114528</td>
      <td>0.581082</td>
      <td>0.581082</td>
    </tr>
    <tr>
      <th>3118</th>
      <td>s23</td>
      <td>4</td>
      <td>8</td>
      <td>neutral</td>
      <td>0.919488</td>
      <td>3.395270</td>
      <td>0.542556</td>
      <td>0.542556</td>
    </tr>
    <tr>
      <th>37</th>
      <td>s25</td>
      <td>2</td>
      <td>6</td>
      <td>neutral</td>
      <td>0.917223</td>
      <td>4.631054</td>
      <td>0.475143</td>
      <td>0.475143</td>
    </tr>
    <tr>
      <th>4077</th>
      <td>s5</td>
      <td>4</td>
      <td>13</td>
      <td>incongruent</td>
      <td>0.742321</td>
      <td>3.207646</td>
      <td>0.499061</td>
      <td>0.499061</td>
    </tr>
    <tr>
      <th>350</th>
      <td>s16</td>
      <td>1</td>
      <td>32</td>
      <td>incongruent</td>
      <td>0.762060</td>
      <td>3.576242</td>
      <td>0.454536</td>
      <td>0.454536</td>
    </tr>
    <tr>
      <th>1105</th>
      <td>s24</td>
      <td>5</td>
      <td>25</td>
      <td>incongruent</td>
      <td>0.896856</td>
      <td>3.200232</td>
      <td>0.581082</td>
      <td>0.581082</td>
    </tr>
    <tr>
      <th>844</th>
      <td>s8</td>
      <td>2</td>
      <td>14</td>
      <td>incongruent</td>
      <td>0.061839</td>
      <td>-3.232000</td>
      <td>0.477679</td>
      <td>0.477679</td>
    </tr>
    <tr>
      <th>602</th>
      <td>s22</td>
      <td>4</td>
      <td>27</td>
      <td>incongruent</td>
      <td>0.701941</td>
      <td>3.182802</td>
      <td>0.431980</td>
      <td>0.431980</td>
    </tr>
    <tr>
      <th>766</th>
      <td>s11</td>
      <td>4</td>
      <td>31</td>
      <td>neutral</td>
      <td>0.749664</td>
      <td>4.908618</td>
      <td>0.443325</td>
      <td>0.443325</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Finally we’ll print out the proportion of data identified as outliers, by computing the number of <em>z</em> values that exceed our threshold, relative to the total number of <em>z</em> values (i.e., the number of rows in the DataFrame):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z_thresh</span><span class="p">][</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c1"># Convert proportion to percent, and round to 2 decimal places</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">outliers</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f the data identified as outliers and replaced with mean value.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.17 % of the data identified as outliers and replaced with mean value.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualizing-the-cleaned-data">
<h2>Visualizing the cleaned data<a class="headerlink" href="#visualizing-the-cleaned-data" title="Permalink to this heading">#</a></h2>
<section id="box-plots">
<h3>Box plots<a class="headerlink" href="#box-plots" title="Permalink to this heading">#</a></h3>
<section id="before-outlier-correction">
<h4>Before outlier correction<a class="headerlink" href="#before-outlier-correction" title="Permalink to this heading">#</a></h4>
<p>Let’s generate a box plot of the original RT values for reference (this is the same as the one plotted at the top of this lesson).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">x</span><span class="o">=</span><span class="s1">&#39;flankers&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6438e772fb60ba8e9830fe9270ca9338d9ebf38244f2338b78d91bd99de6e76c.png" src="../_images/6438e772fb60ba8e9830fe9270ca9338d9ebf38244f2338b78d91bd99de6e76c.png" />
</div>
</div>
</section>
<section id="after-outlier-correction">
<h4>After outlier correction<a class="headerlink" href="#after-outlier-correction" title="Permalink to this heading">#</a></h4>
<p>Below, we can see that the number of short RT outliers is reduced, and those that remain are very close to the whiskers (and also greater than 200 ms). At the same time, the number of outliers at the long RT end of the distribution is also reduced, but there are still more of them than at the short end (which is reasonable, for RT data).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">x</span><span class="o">=</span><span class="s1">&#39;flankers&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rt_clean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3af15843f25a0ad1b29b1372f7464efcf9fa5df37baa45752112b8b20ce5cddc.png" src="../_images/3af15843f25a0ad1b29b1372f7464efcf9fa5df37baa45752112b8b20ce5cddc.png" />
</div>
</div>
</section>
</section>
<section id="kernel-density-estimates">
<h3>Kernel density estimates<a class="headerlink" href="#kernel-density-estimates" title="Permalink to this heading">#</a></h3>
<section id="id1">
<h4>Before outlier correction<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;flankers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2f5976a242a3e19132649913beff3c368802952c0e5d3fabf084449659268e82.png" src="../_images/2f5976a242a3e19132649913beff3c368802952c0e5d3fabf084449659268e82.png" />
</div>
</div>
</section>
<section id="id2">
<h4>After outlier correction<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<p>We can see that the distributions look less “peaky” in the middle with long tails. The long tails were caused by the few outlier data points at extreme ends of the 0–1 s range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span>
           <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
           <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rt_clean&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;flankers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f65aaf1125c3ea27d40a8e9431c68b8d0aa23e6c93a8ff3f2fc12b2815d26bbb.png" src="../_images/f65aaf1125c3ea27d40a8e9431c68b8d0aa23e6c93a8ff3f2fc12b2815d26bbb.png" />
</div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./5-eda"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="repeated_measures.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Working with Repeated Measures Data</p>
      </div>
    </a>
    <a class="right-next"
       href="ttests.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Basic Statistics in Python: <em>t</em> tests with SciPy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outlier-identification-and-removal">Outlier Identification and Removal</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tukey-s-method">Tukey’s method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-scores">Standard scores</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identifying-outliers">Identifying outliers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-distribution">Visualizing the distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#idenfity-outliers-in-a-dataframe">Idenfity outliers in a DataFrame</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#marking-data-points-as-outliers">Marking data points as outliers</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-scores-z-transform">Standard scores (<em>z</em> transform)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#write-column-of-standard-score-outliers">Write column of standard score outliers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-outliers-a-problem">Why are outliers a problem?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#which-method-to-use">Which method to use?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-empirical-study-addressing-outlier-removal-with-rt-data">An empirical study addressing outlier removal with RT data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-to-do-with-outliers">What to do with outliers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ignore-them">1. Ignore them</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-them-from-the-data-set">2. Remove them from the data set</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replace-them-with-non-outlier-values">3. Replace them with non-outlier values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replacing-outliers-with-mean-values">Replacing outliers with mean values</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reporting-outlier-rejections">Reporting outlier rejections</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-nested-data">Working with nested data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-z-scores-by-participant">Compute <em>z</em> scores by participant</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-mean-rt-from-valid-trials-for-each-participant">Compute mean RT from valid trials for each participant</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fill-in-mean-values-for-outlier-rows">Fill in mean values for outlier rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-final-output-column">Create final output column</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-cleaned-data">Visualizing the cleaned data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#box-plots">Box plots</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#before-outlier-correction">Before outlier correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#after-outlier-correction">After outlier correction</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-density-estimates">Kernel density estimates</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Before outlier correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">After outlier correction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aaron J Newman
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2020-23. This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Unported License.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>